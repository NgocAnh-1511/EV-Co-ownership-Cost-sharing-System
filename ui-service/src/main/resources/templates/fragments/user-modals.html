<!-- User Dashboard Modals Fragment -->
<div th:fragment="modals">
    <!-- Deposit Modal (N·∫°p ti·ªÅn) -->
    <div id="depositModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-arrow-up"></i>
                    N·∫°p ti·ªÅn v√†o qu·ªπ
                </h3>
                <button class="modal-close" onclick="closeDepositModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="depositForm" class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <span>Ti·ªÅn n·∫°p s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t ngay l·∫≠p t·ª©c v√†o qu·ªπ chung</span>
                </div>
                <div class="form-group">
                    <label for="depositGroup">Nh√≥m</label>
                    <select id="depositGroup" name="groupId" required>
                        <option value="">ƒêang t·∫£i...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="depositAmount">S·ªë ti·ªÅn (VNƒê)</label>
                    <input type="number" id="depositAmount" name="amount" required min="1000" step="1000" 
                           placeholder="VD: 500000">
                </div>
                <div class="form-group">
                    <label for="depositPurpose">M·ª•c ƒë√≠ch</label>
                    <textarea id="depositPurpose" name="purpose" rows="3" 
                              placeholder="VD: ƒê√≥ng qu·ªπ th√°ng 11/2024" required></textarea>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeDepositModal()">
                    H·ªßy
                </button>
                <button type="submit" form="depositForm" class="btn btn-success">
                    <i class="fas fa-check"></i>
                    X√°c nh·∫≠n n·∫°p ti·ªÅn
                </button>
            </div>
        </div>
    </div>

    <!-- Withdraw Vote Modal (T·∫°o phi·∫øu r√∫t ti·ªÅn) -->
    <div id="withdrawVoteModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-vote-yea"></i>
                    T·∫°o phi·∫øu b·ªè phi·∫øu r√∫t ti·ªÅn
                </h3>
                <button class="modal-close" onclick="closeWithdrawVoteModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="withdrawVoteForm" class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>Quy tr√¨nh r√∫t ti·ªÅn:</strong>
                        <ol style="margin: 0.5rem 0 0 1rem; padding-left: 1rem;">
                            <li>T·∫°o phi·∫øu b·ªè phi·∫øu cho y√™u c·∫ßu r√∫t ti·ªÅn</li>
                            <li>C√°c th√†nh vi√™n trong nh√≥m s·∫Ω b·ªè phi·∫øu (3 ng√†y)</li>
                            <li>N·∫øu vote PASS ‚Üí Admin ph√™ duy·ªát ‚Üí Ti·ªÅn ƒë∆∞·ª£c r√∫t</li>
                            <li>N·∫øu vote KH√îNG PASS ‚Üí Y√™u c·∫ßu b·ªã t·ª´ ch·ªëi</li>
                        </ol>
                    </div>
                </div>
                <div class="form-group">
                    <label for="withdrawGroup">Nh√≥m</label>
                    <select id="withdrawGroup" name="groupId" required>
                        <option value="">ƒêang t·∫£i...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="withdrawAmount">S·ªë ti·ªÅn mu·ªën r√∫t (VNƒê)</label>
                    <input type="number" id="withdrawAmount" name="amount" required min="1000" step="1000" 
                           placeholder="VD: 200000">
                    <small class="form-text">S·ªë d∆∞ kh·∫£ d·ª•ng: <span id="availableBalance">0 VNƒê</span></small>
                </div>
                <div class="form-group">
                    <label for="withdrawPurpose">M·ª•c ƒë√≠ch r√∫t ti·ªÅn (S·∫Ω hi·ªÉn th·ªã trong phi·∫øu vote)</label>
                    <textarea id="withdrawPurpose" name="purpose" rows="4" 
                              placeholder="VD: S·ª≠a ch·ªØa ƒë·ªông c∆° xe, chi ph√≠ d·ª± ki·∫øn 200.000 VNƒê" required></textarea>
                </div>
                <div class="form-group">
                    <label for="withdrawReceipt">Link h√≥a ƒë∆°n/b√°o gi√° (T√πy ch·ªçn)</label>
                    <input type="url" id="withdrawReceipt" name="receiptUrl" 
                           placeholder="https://example.com/receipt.pdf">
                    <small class="form-text">ƒê√≠nh k√®m h√≥a ƒë∆°n gi√∫p tƒÉng kh·∫£ nƒÉng vote th√¥ng qua</small>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeWithdrawVoteModal()">
                    H·ªßy
                </button>
                <button type="submit" form="withdrawVoteForm" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i>
                    T·∫°o phi·∫øu b·ªè phi·∫øu
                </button>
            </div>
        </div>
    </div>

    <!-- Create Decision Modal (T·∫°o quy·∫øt ƒë·ªãnh chung) -->
    <div id="createDecisionModal" class="modal-overlay">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-hand-paper"></i>
                    T·∫°o quy·∫øt ƒë·ªãnh chung
                </h3>
                <button class="modal-close" onclick="closeCreateDecisionModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="createDecisionForm" class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Quy·∫øt ƒë·ªãnh chung:</strong> T·∫°o phi·∫øu b·ªè phi·∫øu cho c√°c quy·∫øt ƒë·ªãnh quan tr·ªçng c·ªßa nh√≥m nh∆∞ n√¢ng c·∫•p pin, b·∫£o hi·ªÉm, b√°n xe, v.v.
                    </div>
                </div>
                <div class="form-group">
                    <label for="decisionGroup">Nh√≥m</label>
                    <select id="decisionGroup" name="groupId" required>
                        <option value="">ƒêang t·∫£i...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="decisionType">Lo·∫°i quy·∫øt ƒë·ªãnh</label>
                    <select id="decisionType" name="decisionType" required>
                        <option value="">Ch·ªçn lo·∫°i quy·∫øt ƒë·ªãnh</option>
                        <option value="battery_upgrade">üîã N√¢ng c·∫•p pin</option>
                        <option value="insurance">üõ°Ô∏è B·∫£o hi·ªÉm</option>
                        <option value="sell_vehicle">üöó B√°n xe</option>
                        <option value="maintenance">üîß B·∫£o d∆∞·ª°ng l·ªõn</option>
                        <option value="upgrade">‚ö° N√¢ng c·∫•p kh√°c</option>
                        <option value="other">üìã Kh√°c</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="decisionTopic">Ch·ªß ƒë·ªÅ quy·∫øt ƒë·ªãnh</label>
                    <input type="text" id="decisionTopic" name="topic" required 
                           placeholder="VD: N√¢ng c·∫•p pin t·ª´ 50kWh l√™n 75kWh" maxlength="255">
                    <small class="form-text">M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ quy·∫øt ƒë·ªãnh c·∫ßn b·ªè phi·∫øu</small>
                </div>
                <div class="form-group">
                    <label for="decisionOptionA">L·ª±a ch·ªçn A (ƒê·ªìng √Ω)</label>
                    <input type="text" id="decisionOptionA" name="optionA" required 
                           placeholder="VD: ƒê·ªìng √Ω n√¢ng c·∫•p pin" maxlength="100">
                </div>
                <div class="form-group">
                    <label for="decisionOptionB">L·ª±a ch·ªçn B (Kh√¥ng ƒë·ªìng √Ω)</label>
                    <input type="text" id="decisionOptionB" name="optionB" required 
                           placeholder="VD: Kh√¥ng ƒë·ªìng √Ω n√¢ng c·∫•p pin" maxlength="100">
                </div>
                <div class="form-group">
                    <label for="decisionDescription">M√¥ t·∫£ chi ti·∫øt (T√πy ch·ªçn)</label>
                    <textarea id="decisionDescription" name="description" rows="4" 
                              placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ quy·∫øt ƒë·ªãnh, l√Ω do, chi ph√≠ d·ª± ki·∫øn, v.v."></textarea>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeCreateDecisionModal()">
                    H·ªßy
                </button>
                <button type="submit" form="createDecisionForm" class="btn btn-info">
                    <i class="fas fa-paper-plane"></i>
                    T·∫°o quy·∫øt ƒë·ªãnh
                </button>
            </div>
        </div>
    </div>

    <!-- Join Group Modal -->
    <div id="joinGroupModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-user-plus"></i>
                    Tham gia nh√≥m
                </h3>
                <button class="modal-close" onclick="closeJoinGroupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="joinGroupForm" class="modal-body" novalidate>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Th√¥ng tin nh√≥m:</strong>
                        <div id="join-group-info" style="margin-top: 0.5rem;">
                            <!-- Group info loaded dynamically -->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="joinOwnershipPercent">T·ª∑ l·ªá s·ªü h·ªØu c·ªßa b·∫°n (%)</label>
                    <input type="number" id="joinOwnershipPercent" name="ownershipPercent" 
                           min="0" max="100" step="0.01" 
                           placeholder="VD: 25.5">
                    <small class="form-text">
                        <i class="fas fa-exclamation-triangle"></i>
                        Vui l√≤ng nh·∫≠p t·ª∑ l·ªá s·ªü h·ªØu c·ªßa b·∫°n trong nh√≥m n√†y. 
                        T·ªïng t·ª∑ l·ªá s·ªü h·ªØu c·ªßa t·∫•t c·∫£ th√†nh vi√™n kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 100%.
                    </small>
                </div>
                <input type="hidden" id="join-group-id" name="groupId">
                <input type="hidden" id="join-user-id" name="userId">
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeJoinGroupModal()">
                    H·ªßy
                </button>
                <button type="button" id="joinGroupSubmitBtn" class="btn btn-primary">
                    <i class="fas fa-check"></i>
                    Tham gia nh√≥m
                </button>
            </div>
        </div>
    </div>

    <!-- Create Group Modal -->
    <div id="createGroupModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-plus-circle"></i>
                    T·∫°o nh√≥m m·ªõi
                </h3>
                <button class="modal-close" onclick="closeCreateGroupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="createGroupForm" class="modal-body" novalidate>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <span>Khi t·∫°o nh√≥m m·ªõi, b·∫°n s·∫Ω t·ª± ƒë·ªông tr·ªü th√†nh Admin c·ªßa nh√≥m ƒë√≥.</span>
                </div>
                <div class="form-group">
                    <label for="createGroupName">T√™n nh√≥m <span class="required">*</span></label>
                    <input type="text" id="createGroupName" name="groupName" 
                           required placeholder="VD: Nh√≥m ƒë·ªìng s·ªü h·ªØu Tesla Model 3">
                    <small class="form-text">T√™n nh√≥m s·∫Ω hi·ªÉn th·ªã cho t·∫•t c·∫£ th√†nh vi√™n</small>
                </div>
                <div class="form-group">
                    <label for="createGroupVehicleId">Vehicle ID (T√πy ch·ªçn)</label>
                    <input type="number" id="createGroupVehicleId" name="vehicleId" 
                           min="1" placeholder="VD: 1">
                    <small class="form-text">ID c·ªßa xe ƒëi·ªán trong h·ªá th·ªëng (n·∫øu c√≥)</small>
                </div>
                <div class="form-group">
                    <label for="createGroupOwnershipPercent">T·ª∑ l·ªá s·ªü h·ªØu c·ªßa b·∫°n (%)</label>
                    <input type="number" id="createGroupOwnershipPercent" name="ownershipPercent" 
                           min="0" max="100" step="0.01" placeholder="VD: 50.00">
                    <small class="form-text">T·ª∑ l·ªá s·ªü h·ªØu c·ªßa b·∫°n trong nh√≥m (0-100%). C√≥ th·ªÉ ƒë·ªÉ tr·ªëng ho·∫∑c c·∫≠p nh·∫≠t sau.</small>
                </div>
                <div class="form-group">
                    <label for="createGroupStatus">Tr·∫°ng th√°i</label>
                    <select id="createGroupStatus" name="status">
                        <option value="Active">ƒêang ho·∫°t ƒë·ªông</option>
                        <option value="Inactive">T·∫°m ng∆∞ng</option>
                    </select>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeCreateGroupModal()">
                    H·ªßy
                </button>
                <button type="button" id="createGroupSubmitBtn" class="btn btn-primary">
                    <i class="fas fa-check"></i>
                    T·∫°o nh√≥m
                </button>
            </div>
        </div>
    </div>

    <!-- Manage Group Modal -->
    <div id="manageGroupModal" class="modal-overlay">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-users-cog"></i>
                    Qu·∫£n l√Ω nh√≥m: <span id="manage-group-name"></span>
                </h3>
                <button class="modal-close" onclick="closeManageGroupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Add Member Section -->
                <div class="manage-section">
                    <h4><i class="fas fa-user-plus"></i> Th√™m th√†nh vi√™n</h4>
                    <form id="addMemberForm" class="form-inline">
                        <div class="form-group">
                            <label for="newMemberUserId">User ID:</label>
                            <input type="number" id="newMemberUserId" name="userId" 
                                   min="1" required placeholder="Nh·∫≠p User ID">
                        </div>
                        <div class="form-group">
                            <label for="newMemberOwnership">T·ª∑ l·ªá s·ªü h·ªØu (%):</label>
                            <input type="number" id="newMemberOwnership" name="ownershipPercent" 
                                   min="0" max="100" step="0.01" required placeholder="VD: 25.5">
                        </div>
                        <div class="form-group">
                            <label for="newMemberRole">Quy·ªÅn:</label>
                            <select id="newMemberRole" name="role">
                                <option value="Member">Th√†nh vi√™n</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Th√™m
                        </button>
                    </form>
                </div>

                <!-- Members List Section -->
                <div class="manage-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="margin: 0;"><i class="fas fa-users"></i> Danh s√°ch th√†nh vi√™n</h4>
                        <button class="btn btn-warning btn-sm" onclick="openLeaveRequestsModalFromManage()">
                            <i class="fas fa-clipboard-list"></i> Y√™u c·∫ßu r·ªùi nh√≥m
                        </button>
                    </div>
                    <div id="members-list-container">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i...
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeManageGroupModal()">
                    ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- View Group Modal -->
    <div id="viewGroupModal" class="modal-overlay">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-info-circle"></i>
                    Th√¥ng tin nh√≥m: <span id="view-group-name"></span>
                </h3>
                <button class="modal-close" onclick="closeViewGroupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- My Membership Info -->
                <div class="manage-section">
                    <h4><i class="fas fa-user"></i> Th√¥ng tin th√†nh vi√™n c·ªßa t√¥i</h4>
                    <div id="my-membership-info" class="membership-info-card">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i...
                        </div>
                    </div>
                </div>

                <!-- Group Members List -->
                <div class="manage-section">
                    <h4><i class="fas fa-users"></i> Danh s√°ch th√†nh vi√™n</h4>
                    <div id="view-members-list-container">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i...
                        </div>
                    </div>
                </div>

                <!-- Leave Group Section -->
                <div class="manage-section">
                    <h4><i class="fas fa-sign-out-alt"></i> R·ªùi nh√≥m</h4>
                    <div id="leave-request-status"></div>
                    <form id="leaveGroupForm" class="form-inline">
                        <div class="form-group full-width">
                            <label for="leaveReason">L√Ω do r·ªùi nh√≥m (t√πy ch·ªçn):</label>
                            <textarea id="leaveReason" name="reason" rows="3" 
                                      placeholder="Nh·∫≠p l√Ω do b·∫°n mu·ªën r·ªùi nh√≥m..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-danger" id="submitLeaveRequestBtn">
                            <i class="fas fa-sign-out-alt"></i> G·ª≠i y√™u c·∫ßu r·ªùi nh√≥m
                        </button>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeViewGroupModal()">
                    ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- Leave Requests Modal (Admin) -->
    <div id="leaveRequestsModal" class="modal-overlay">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-clipboard-list"></i>
                    Y√™u c·∫ßu r·ªùi nh√≥m: <span id="leave-requests-group-name"></span>
                </h3>
                <button class="modal-close" onclick="closeLeaveRequestsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="leave-requests-container">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i...
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeLeaveRequestsModal()">
                    ƒê√≥ng
                </button>
            </div>
        </div>
    </div>
</div>

