<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Nhóm Đồng Sở Hữu - CarShare Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/layout.css}" rel="stylesheet">
    <link th:href="@{/css/group-management.css}" rel="stylesheet">
</head>
<body>
    <!-- Layout Container -->
    <div class="layout-container">
        <!-- Include Sidebar Fragment -->
        <div th:replace="fragments/sidebar :: sidebar"></div>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="top-bar-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-info">
                        <h1 class="page-title">
                            <i class="fas fa-users"></i>
                            Quản Lý Nhóm Đồng Sở Hữu
                        </h1>
                        <p class="page-subtitle">Tạo và quản lý các nhóm sở hữu chung xe điện</p>
                    </div>
                </div>
                <div class="top-bar-actions">
                    <button class="btn btn-outline" onclick="exportGroups()">
                        <i class="fas fa-download"></i>
                        Xuất danh sách
                    </button>
                    <button class="btn btn-primary" onclick="openCreateGroupModal()">
                        <i class="fas fa-plus"></i>
                        Tạo nhóm mới
                    </button>
                </div>
            </div>
            
            <!-- Content Area -->
            <div class="content-area">
                <!-- Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="card-icon blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-content">
                            <h3>Tổng nhóm</h3>
                            <p class="card-number" th:text="${summary?.totalGroups ?: 12}">12</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="card-icon green">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="card-content">
                            <h3>Tổng thành viên</h3>
                            <p class="card-number" th:text="${summary?.totalMembers ?: 48}">48</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="card-icon yellow">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="card-content">
                            <h3>Xe trong nhóm</h3>
                            <p class="card-number" th:text="${summary?.totalCars ?: 25}">25</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="card-icon purple">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-content">
                            <h3>Nhóm hoạt động</h3>
                            <p class="card-number" th:text="${summary?.activeGroups ?: 10}">10</p>
                        </div>
                    </div>
                </div>

                <!-- Group List Section -->
                <div class="group-list-section">
                    <div class="section-header">
                        <h2>Danh sách nhóm</h2>
                        <div class="search-filter-bar">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Tìm kiếm nhóm..." class="search-input">
                            </div>
                            <div class="filter-dropdown">
                                <select class="filter-select">
                                    <option>Tất cả trạng thái</option>
                                    <option>Hoạt động</option>
                                    <option>Tạm dừng</option>
                                    <option>Đã kết thúc</option>
                                </select>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Group Cards -->
                    <div class="group-cards">
                        <!-- Dynamic Group Cards -->
                        <div th:each="group : ${groups}" class="group-card">
                            <div class="group-header">
                                <h3 class="group-name" th:text="${group.name}">Tên nhóm</h3>
                                <span class="status-badge" th:classappend="${group.status == 'Hoạt động'} ? 'active' : (${group.status == 'Tạm dừng'} ? 'paused' : 'inactive')" th:text="${group.status}">Trạng thái</span>
                            </div>
                            <div class="group-members">
                                <div class="members-info">
                                    <span class="members-label" th:text="'Thành viên (' + ${group.memberCount} + ')'">Thành viên</span>
                                    <div class="member-avatars">
                                        <img th:each="member, iterStat : ${group.members}" 
                                             th:if="${iterStat.index < 3}"
                                             th:src="${member.avatar ?: 'https://via.placeholder.com/32'}" 
                                             th:alt="${member.name}"
                                             src="https://via.placeholder.com/32" alt="Member">
                                        <span th:if="${group.memberCount > 3}" class="more-members" th:text="'+' + (${group.memberCount} - 3)">+1</span>
                                    </div>
                                </div>
                            </div>
                            <div class="group-cars">
                                <span class="cars-label" th:text="'Xe trong nhóm (' + ${group.carCount} + ')'">Xe trong nhóm</span>
                                <div class="car-list">
                                    <span th:each="car : ${group.cars}" class="car-item" th:text="${car.fullName}">Tên xe</span>
                                </div>
                            </div>
                            <div class="group-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Tổng chuyến:</span>
                                    <span class="stat-value" th:text="${group.totalTrips}">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Doanh thu:</span>
                                    <span class="stat-value" th:text="${#numbers.formatDecimal(group.totalRevenue, 1, 1)} + 'M VNĐ'">0M VNĐ</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Tỷ lệ sử dụng:</span>
                                    <span class="stat-value" th:text="${#numbers.formatDecimal(group.usageRate, 0, 0)} + '%'">0%</span>
                                </div>
                            </div>
                            <div class="group-actions">
                                <a th:href="@{'/groups/' + ${group.id} + '/edit'}" class="action-btn edit" title="Chỉnh sửa">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a th:href="@{'/groups/' + ${group.id} + '/members'}" class="action-btn members" title="Thành viên">
                                    <i class="fas fa-users"></i>
                                </a>
                                <a th:href="@{'/groups/' + ${group.id} + '/cars'}" class="action-btn cars" title="Xe">
                                    <i class="fas fa-car"></i>
                                </a>
                                <form th:action="@{'/groups/' + ${group.id} + '/delete'}" method="post" style="display: inline;">
                                    <button type="submit" class="action-btn delete" title="Xóa" onclick="return confirm('Bạn có chắc chắn muốn xóa nhóm này?')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Fallback static cards if no data -->
                        <div th:if="${groups == null or #lists.isEmpty(groups)}" class="group-cards">
                            <div class="group-card">
                                <div class="group-header">
                                    <h3 class="group-name">Nhóm Gia Đình Nguyễn</h3>
                                    <span class="status-badge active">Hoạt động</span>
                                </div>
                                <div class="group-members">
                                    <div class="members-info">
                                        <span class="members-label">Thành viên (4)</span>
                                        <div class="member-avatars">
                                            <img src="https://via.placeholder.com/32" alt="Member 1">
                                            <img src="https://via.placeholder.com/32" alt="Member 2">
                                            <img src="https://via.placeholder.com/32" alt="Member 3">
                                            <span class="more-members">+1</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="group-cars">
                                    <span class="cars-label">Xe trong nhóm (3)</span>
                                    <div class="car-list">
                                        <span class="car-item">Honda City 2022</span>
                                        <span class="car-item">Toyota Vios 2021</span>
                                        <span class="car-item">Mazda 3 2023</span>
                                    </div>
                                </div>
                                <div class="group-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Tổng chuyến:</span>
                                        <span class="stat-value">156</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Doanh thu:</span>
                                        <span class="stat-value">45.2M VNĐ</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Tỷ lệ sử dụng:</span>
                                        <span class="stat-value">78%</span>
                                    </div>
                                </div>
                                <div class="group-actions">
                                    <button class="action-btn edit" title="Chỉnh sửa">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn members" title="Thành viên">
                                        <i class="fas fa-users"></i>
                                    </button>
                                    <button class="action-btn cars" title="Xe">
                                        <i class="fas fa-car"></i>
                                    </button>
                                    <button class="action-btn delete" title="Xóa">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination">
                        <div class="pagination-info">
                            Hiển thị 1-3 trong tổng số 12 nhóm
                        </div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled>Trước</button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">2</button>
                            <button class="pagination-btn">3</button>
                            <button class="pagination-btn">Sau</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script th:src="@{/js/layout.js}"></script>
    <script th:src="@{/js/group-management.js}"></script>
</body>
</html>