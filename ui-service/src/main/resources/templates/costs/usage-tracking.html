<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nh·∫≠p Km S·ª≠ D·ª•ng - CarShare Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/layout.css}" rel="stylesheet">
    <link th:href="@{/css/dashboard.css}" rel="stylesheet">
    <link th:href="@{/css/cost-management.css}" rel="stylesheet">
</head>
<body>
    <!-- Layout Container -->
    <div class="layout-container">
        <!-- Include Sidebar -->
        <div th:replace="fragments/sidebar :: sidebar"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="top-bar-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-info">
                        <h1 class="page-title">üìä Nh·∫≠p Km S·ª≠ D·ª•ng</h1>
                        <p class="page-subtitle">Nh·∫≠p s·ªë km ƒë√£ ch·∫°y trong th√°ng ƒë·ªÉ t·ª± ƒë·ªông chia chi ph√≠ s·∫°c ƒëi·ªán c√¥ng b·∫±ng</p>
                    </div>
                </div>
                <div class="top-bar-actions">
                    <a href="/costs/auto-split" class="btn btn-primary">
                        <i class="fas fa-calculator"></i>
                        T·∫°o chi ph√≠ t·ª± ƒë·ªông
                    </a>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Info Alert -->
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>H∆∞·ªõng d·∫´n:</strong> Nh·∫≠p s·ªë km b·∫°n ƒë√£ ch·∫°y trong th√°ng n√†y. 
                        H·ªá th·ªëng s·∫Ω d√πng d·ªØ li·ªáu n√†y ƒë·ªÉ t·ª± ƒë·ªông chia chi ph√≠ s·∫°c ƒëi·ªán theo m·ª©c ƒë·ªô s·ª≠ d·ª•ng.
                    </div>
                </div>

                <!-- Month Selection -->
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-calendar"></i>
                            Ch·ªçn th√°ng
                        </h3>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="selectMonth">Th√°ng</label>
                                <select id="selectMonth" class="form-control">
                                    <option value="1">Th√°ng 1</option>
                                    <option value="2">Th√°ng 2</option>
                                    <option value="3">Th√°ng 3</option>
                                    <option value="4">Th√°ng 4</option>
                                    <option value="5">Th√°ng 5</option>
                                    <option value="6">Th√°ng 6</option>
                                    <option value="7">Th√°ng 7</option>
                                    <option value="8">Th√°ng 8</option>
                                    <option value="9">Th√°ng 9</option>
                                    <option value="10" selected>Th√°ng 10</option>
                                    <option value="11">Th√°ng 11</option>
                                    <option value="12">Th√°ng 12</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="selectYear">NƒÉm</label>
                                <select id="selectYear" class="form-control">
                                    <option value="2024" selected>2024</option>
                                    <option value="2025">2025</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="selectGroup">Nh√≥m</label>
                                <select id="selectGroup" class="form-control">
                                    <option value="1">Group 1 - Tesla Model 3</option>
                                    <option value="2">Group 2 - BMW i3</option>
                                </select>
                            </div>
                            <div class="form-group" style="align-self: flex-end;">
                                <button type="button" class="btn btn-primary w-100" onclick="loadUsageData()">
                                    <i class="fas fa-search"></i>
                                    Xem d·ªØ li·ªáu
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Usage Input Form -->
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-road"></i>
                            Nh·∫≠p s·ªë km
                        </h3>
                        <span class="badge badge-info" id="totalKmBadge">T·ªïng: 0 km</span>
                    </div>
                    <div class="card-content">
                        <form id="usageForm">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>User</th>
                                            <th>S·ªë km ƒë√£ ch·∫°y</th>
                                            <th>% s·ª≠ d·ª•ng</th>
                                            <th>Ghi ch√∫</th>
                                            <th>Thao t√°c</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usageTableBody">
                                        <!-- Sample row -->
                                        <tr data-user-id="1">
                                            <td>
                                                <div class="user-info">
                                                    <i class="fas fa-user-circle"></i>
                                                    <strong>User 1</strong>
                                                </div>
                                            </td>
                                            <td>
                                                <input type="number" class="form-control km-input" 
                                                       value="0" min="0" step="0.1"
                                                       onchange="calculatePercentages()">
                                            </td>
                                            <td>
                                                <span class="badge badge-primary percent-badge">0%</span>
                                            </td>
                                            <td>
                                                <input type="text" class="form-control" 
                                                       placeholder="Ghi ch√∫...">
                                            </td>
                                            <td>
                                                <button type="button" class="btn btn-sm btn-success" 
                                                        onclick="saveUserUsage(1)">
                                                    <i class="fas fa-save"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-success" onclick="saveAllUsage()">
                                    <i class="fas fa-save"></i>
                                    L∆∞u t·∫•t c·∫£
                                </button>
                                <button type="button" class="btn btn-outline" onclick="resetForm()">
                                    <i class="fas fa-redo"></i>
                                    L√†m m·ªõi
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Usage Statistics -->
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-chart-pie"></i>
                            Th·ªëng k√™ s·ª≠ d·ª•ng
                        </h3>
                    </div>
                    <div class="card-content">
                        <div class="stats-grid" id="usageStats">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-tachometer-alt"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="totalKmStat">0 km</div>
                                    <div class="stat-label">T·ªïng km nh√≥m</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="avgKmStat">0 km</div>
                                    <div class="stat-label">Trung b√¨nh/ng∆∞·ªùi</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-crown"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="maxUserStat">-</div>
                                    <div class="stat-label">D√πng nhi·ªÅu nh·∫•t</div>
                                </div>
                            </div>
                        </div>

                        <!-- Usage Chart -->
                        <div class="chart-container" style="margin-top: 2rem;">
                            <canvas id="usageChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script th:src="@{/js/layout.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:src="@{/js/usage-tracking.js}"></script>
</body>
</html>

