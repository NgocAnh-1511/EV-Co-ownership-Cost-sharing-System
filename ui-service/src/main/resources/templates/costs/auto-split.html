<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·∫°o Chi Ph√≠ T·ª± ƒê·ªông - CarShare Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/layout.css}" rel="stylesheet">
    <link th:href="@{/css/dashboard.css}" rel="stylesheet">
    <link th:href="@{/css/cost-management.css}" rel="stylesheet">
</head>
<body>
    <!-- Layout Container -->
    <div class="layout-container">
        <!-- Include Sidebar -->
        <div th:replace="fragments/sidebar :: sidebar"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="top-bar-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-info">
                        <h1 class="page-title">ü§ñ T·∫°o Chi Ph√≠ T·ª± ƒê·ªông</h1>
                        <p class="page-subtitle">H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông chia chi ph√≠ theo ph∆∞∆°ng th·ª©c b·∫°n ch·ªçn</p>
                    </div>
                </div>
                <div class="top-bar-actions">
                    <a href="/costs/usage-tracking" class="btn btn-outline">
                        <i class="fas fa-road"></i>
                        Nh·∫≠p km
                    </a>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Info Cards -->
                <div class="content-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                    <div class="card info-card">
                        <div class="card-content">
                            <div class="info-icon" style="color: #3b82f6;">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <h4>Theo S·ªü H·ªØu</h4>
                            <p>Chia theo % g√≥p v·ªën. Ph√π h·ª£p: B·∫£o hi·ªÉm, ƒëƒÉng ki·ªÉm, b·∫£o d∆∞·ª°ng</p>
                            <small>V√≠ d·ª•: 50%, 30%, 20%</small>
                        </div>
                    </div>
                    <div class="card info-card">
                        <div class="card-content">
                            <div class="info-icon" style="color: #10b981;">
                                <i class="fas fa-road"></i>
                            </div>
                            <h4>Theo Km ƒê√£ Ch·∫°y</h4>
                            <p>Chia theo m·ª©c ƒë·ªô s·ª≠ d·ª•ng. Ph√π h·ª£p: S·∫°c ƒëi·ªán, thay l·ªëp</p>
                            <small>V√≠ d·ª•: 600km, 300km, 100km</small>
                        </div>
                    </div>
                    <div class="card info-card">
                        <div class="card-content">
                            <div class="info-icon" style="color: #f59e0b;">
                                <i class="fas fa-equals"></i>
                            </div>
                            <h4>Chia ƒê·ªÅu</h4>
                            <p>Chia ƒë·ªÅu cho t·∫•t c·∫£. Ph√π h·ª£p: R·ª≠a xe, ph·ª• ki·ªán chung</p>
                            <small>V√≠ d·ª•: 33.33% m·ªói ng∆∞·ªùi</small>
                        </div>
                    </div>
                </div>

                <!-- Create Cost Form -->
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-plus-circle"></i>
                            Th√¥ng tin chi ph√≠
                        </h3>
                    </div>
                    <div class="card-content">
                        <form id="costForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="vehicleId">Xe *</label>
                                    <select id="vehicleId" class="form-control" required>
                                        <option value="">-- Ch·ªçn xe --</option>
                                        <option value="1">Vehicle 1 - Tesla Model 3</option>
                                        <option value="2">Vehicle 2 - BMW i3</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="costType">Lo·∫°i chi ph√≠ *</label>
                                    <select id="costType" class="form-control" required onchange="suggestSplitMethod()">
                                        <option value="">-- Ch·ªçn lo·∫°i --</option>
                                        <option value="ElectricCharge">‚ö° S·∫°c ƒëi·ªán</option>
                                        <option value="Maintenance">üîß B·∫£o d∆∞·ª°ng</option>
                                        <option value="Insurance">üõ°Ô∏è B·∫£o hi·ªÉm</option>
                                        <option value="Inspection">üìã ƒêƒÉng ki·ªÉm</option>
                                        <option value="Cleaning">üßΩ V·ªá sinh xe</option>
                                        <option value="Other">üì¶ Kh√°c</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="amount">S·ªë ti·ªÅn (VNƒê) *</label>
                                    <input type="number" id="amount" class="form-control" 
                                           min="0" step="1000" required 
                                           placeholder="Nh·∫≠p s·ªë ti·ªÅn"
                                           onchange="updatePreview()">
                                </div>

                                <div class="form-group">
                                    <label for="splitMethod">Ph∆∞∆°ng th·ª©c chia *</label>
                                    <select id="splitMethod" class="form-control" required onchange="updatePreview()">
                                        <option value="">-- Ch·ªçn ph∆∞∆°ng th·ª©c --</option>
                                        <option value="BY_OWNERSHIP">üìä Theo t·ªâ l·ªá s·ªü h·ªØu</option>
                                        <option value="BY_USAGE">üõ£Ô∏è Theo km ƒë√£ ch·∫°y</option>
                                        <option value="EQUAL">‚ûó Chia ƒë·ªÅu</option>
                                    </select>
                                    <small class="form-text" id="splitMethodHint"></small>
                                </div>

                                <div class="form-group" style="grid-column: 1 / -1;">
                                    <label for="description">M√¥ t·∫£</label>
                                    <textarea id="description" class="form-control" rows="2" 
                                              placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ chi ph√≠..."></textarea>
                                </div>
                            </div>

                            <!-- Preview Result -->
                            <div id="previewSection" class="preview-section" style="display: none;">
                                <h4>
                                    <i class="fas fa-eye"></i>
                                    Xem tr∆∞·ªõc k·∫øt qu·∫£ chia
                                </h4>
                                <div class="preview-content">
                                    <div class="preview-stats">
                                        <div class="preview-stat">
                                            <span class="label">T·ªïng chi ph√≠:</span>
                                            <span class="value" id="previewTotal">0 VNƒê</span>
                                        </div>
                                        <div class="preview-stat">
                                            <span class="label">S·ªë ng∆∞·ªùi chia:</span>
                                            <span class="value" id="previewMembers">0</span>
                                        </div>
                                        <div class="preview-stat">
                                            <span class="label">Ph∆∞∆°ng th·ª©c:</span>
                                            <span class="value" id="previewMethod">-</span>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Th√†nh vi√™n</th>
                                                    <th>Ph·∫ßn trƒÉm</th>
                                                    <th>S·ªë ti·ªÅn</th>
                                                </tr>
                                            </thead>
                                            <tbody id="previewTableBody">
                                                <!-- Will be populated by JS -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-check"></i>
                                    T·∫°o chi ph√≠ & T·ª± ƒë·ªông chia
                                </button>
                                <button type="button" class="btn btn-outline" onclick="resetForm()">
                                    <i class="fas fa-redo"></i>
                                    L√†m m·ªõi
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Recent Auto-Split Costs -->
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <i class="fas fa-history"></i>
                            Chi ph√≠ ƒë√£ chia g·∫ßn ƒë√¢y
                        </h3>
                    </div>
                    <div class="card-content">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Lo·∫°i</th>
                                        <th>M√¥ t·∫£</th>
                                        <th>S·ªë ti·ªÅn</th>
                                        <th>Ph∆∞∆°ng th·ª©c</th>
                                        <th>Ng√†y t·∫°o</th>
                                        <th>Chi ti·∫øt</th>
                                    </tr>
                                </thead>
                                <tbody id="recentCostsBody">
                                    <!-- Sample data -->
                                    <tr>
                                        <td><span class="badge badge-info">‚ö° S·∫°c ƒëi·ªán</span></td>
                                        <td>Chi ph√≠ s·∫°c ƒëi·ªán th√°ng 10/2024</td>
                                        <td><strong>500,000 VNƒê</strong></td>
                                        <td><span class="badge badge-success">üõ£Ô∏è Theo km</span></td>
                                        <td>2024-10-31</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline" onclick="viewCostDetail(1)">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script th:src="@{/js/layout.js}"></script>
    <script th:src="@{/js/auto-split.js}"></script>

    <style>
        .info-card {
            text-align: center;
            transition: transform 0.2s;
        }
        .info-card:hover {
            transform: translateY(-5px);
        }
        .info-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .info-card h4 {
            margin: 0.5rem 0;
            color: var(--text-primary);
        }
        .info-card p {
            color: var(--text-secondary);
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }
        .info-card small {
            color: var(--text-tertiary);
            font-size: 0.85rem;
        }
        .preview-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--surface-secondary);
            border-radius: 8px;
        }
        .preview-section h4 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        .preview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .preview-stat {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .preview-stat .label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        .preview-stat .value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }
    </style>
</body>
</html>

