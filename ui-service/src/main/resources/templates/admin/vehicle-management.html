<div xmlns:th="http://www.thymeleaf.org" th:fragment="content">
<!-- VEHICLE MANAGEMENT SECTION -->
<section id="vehicle-management-section" class="content-section">
    <div class="split-form-card">
        <h3>Quản Lý Xe</h3>
        <p style="color: #64748b; margin-bottom: 24px;">Quản lý thông tin và trạng thái các xe trong hệ thống</p>

        <!-- Search and Filter Section -->
        <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; align-items: center;">
            <form id="searchFilterForm" method="get" th:action="@{/admin/vehicle-management}" style="display: flex; gap: 12px; flex: 1; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px; position: relative;">
                    <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #94a3b8;"></i>
                    <input type="text" 
                           id="searchInput" 
                           name="searchQuery" 
                           th:value="${searchQuery}" 
                           placeholder="Tìm kiếm theo tên xe, biển số, mã xe..."
                           style="width: 100%; padding: 10px 12px 10px 40px; border: 1px solid #e2e8f0; border-radius: 8px;">
                </div>
                <div>
                    <select name="statusFilter" th:value="${statusFilter}" onchange="this.form.submit()" 
                            style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; min-width: 180px;">
                        <option value="all" th:selected="${statusFilter == 'all'}">Tất cả trạng thái</option>
                        <option value="ready" th:selected="${statusFilter == 'ready'}">Sẵn sàng</option>
                        <option value="in_use" th:selected="${statusFilter == 'in_use'}">Đang sử dụng</option>
                        <option value="maintenance" th:selected="${statusFilter == 'maintenance'}">Bảo dưỡng</option>
                        <option value="repair" th:selected="${statusFilter == 'repair'}">Sửa chữa</option>
                        <option value="checking" th:selected="${statusFilter == 'checking'}">Kiểm tra</option>
                    </select>
                </div>
            </form>
            <button class="btn btn-primary" onclick="openAddVehicleModal()">
                <i class="fas fa-plus"></i>
                Thêm Xe Mới
            </button>
        </div>

        <!-- Summary Cards -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
            <div style="background: white; border-radius: 12px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: #667eea; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="fas fa-car"></i>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #64748b; margin-bottom: 4px;">Tổng số xe</div>
                        <div style="font-size: 24px; font-weight: 700; color: #1a202c;" th:text="${totalVehicles}">0</div>
                    </div>
                </div>
            </div>
            <div style="background: white; border-radius: 12px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: #10b981; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #64748b; margin-bottom: 4px;">Sẵn sàng</div>
                        <div style="font-size: 24px; font-weight: 700; color: #1a202c;" th:text="${readyVehicles}">0</div>
                    </div>
                </div>
            </div>
            <div style="background: white; border-radius: 12px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: #3b82f6; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="fas fa-car-side"></i>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #64748b; margin-bottom: 4px;">Đang sử dụng</div>
                        <div style="font-size: 24px; font-weight: 700; color: #1a202c;" th:text="${inUseVehicles}">0</div>
                    </div>
                </div>
            </div>
            <div style="background: white; border-radius: 12px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: #f59e0b; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #64748b; margin-bottom: 4px;">Bảo dưỡng</div>
                        <div style="font-size: 24px; font-weight: 700; color: #1a202c;" th:text="${maintenanceVehicles}">0</div>
                    </div>
                </div>
            </div>
            <div style="background: white; border-radius: 12px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: #ef4444; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="fas fa-wrench"></i>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #64748b; margin-bottom: 4px;">Sửa chữa</div>
                        <div style="font-size: 24px; font-weight: 700; color: #1a202c;" th:text="${repairVehicles}">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Table Section -->
        <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h3 style="margin-bottom: 20px; font-size: 18px; font-weight: 600; color: #1a202c;">Danh Sách Xe</h3>

            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">XE</th>
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">BIỂN SỐ</th>
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">LOẠI XE</th>
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">TRẠNG THÁI</th>
                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748b;">CẬP NHẬT</th>
                            <th style="padding: 12px; text-align: center; font-weight: 600; color: #64748b;">HÀNH ĐỘNG</th>
                        </tr>
                    </thead>
                <tbody id="vehicleTableBody">
                    <tr th:if="${vehicles == null or vehicles.isEmpty()}">
                        <td colspan="6" style="text-align: center; padding: 40px; color: #9CA3AF;">
                            <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; display: block; opacity: 0.3;"></i>
                            Không có xe nào
                        </td>
                    </tr>
                        <tr th:each="vehicle : ${vehicles}" style="border-bottom: 1px solid #f1f5f9;">
                            <td style="padding: 12px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 40px; height: 40px; background: #f1f5f9; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #667eea;">
                                        <i th:class="${vehicle.icon}"></i>
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; color: #1a202c;" th:text="${vehicle.name}">Vehicle Name</div>
                                        <div style="font-size: 12px; color: #94a3b8;" th:text="${vehicle.vehicleId}">ID</div>
                                    </div>
                                </div>
                            </td>
                            <td style="padding: 12px;" th:text="${vehicle.plateNumber}">30A-12345</td>
                            <td style="padding: 12px;" th:text="${vehicle.type}">Electric</td>
                            <td style="padding: 12px;">
                                <span style="padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;
                                    ${vehicle.status == 'ready' ? 'background: #d1fae5; color: #065f46;' : 
                                      vehicle.status == 'in_use' ? 'background: #dbeafe; color: #1e40af;' : 
                                      vehicle.status == 'maintenance' ? 'background: #fef3c7; color: #92400e;' : 
                                      vehicle.status == 'repair' ? 'background: #fee2e2; color: #991b1b;' : 
                                      'background: #f1f5f9; color: #64748b;'}"
                                    th:text="${vehicle.status == 'ready' ? 'Sẵn sàng' : 
                                              (vehicle.status == 'in_use' ? 'Đang sử dụng' : 
                                              (vehicle.status == 'maintenance' ? 'Bảo dưỡng' : 
                                              (vehicle.status == 'repair' ? 'Sửa chữa' : 
                                              (vehicle.status == 'checking' ? 'Kiểm tra' : vehicle.status))))}">
                                    Ready
                                </span>
                            </td>
                            <td style="padding: 12px;" th:text="${vehicle.updateDate}">01/01/2024</td>
                            <td style="padding: 12px; text-align: center;">
                                <div style="display: flex; gap: 8px; justify-content: center;">
                                    <button class="btn btn-sm" 
                                            style="background: #667eea; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer;"
                                            th:attr="data-vehicle-id=${vehicle.vehicleId}"
                                            onclick="openEditVehicleModal(this.getAttribute('data-vehicle-id'))"
                                            title="Chỉnh sửa">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm" 
                                            style="background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer;"
                                            th:attr="data-vehicle-id=${vehicle.vehicleId}"
                                            onclick="openDeleteVehicleModal(this.getAttribute('data-vehicle-id'))"
                                            title="Xóa">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                </tbody>
            </table>

                <!-- Pagination -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e2e8f0;">
                    <div style="color: #64748b; font-size: 14px;">
                        Hiển thị <span th:text="${startIndex}">1</span> - <span th:text="${endIndex}">10</span> 
                        trong tổng số <span th:text="${totalFiltered}">100</span> xe
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <a th:if="${currentPage > 1}" 
                           th:href="@{/admin/vehicle-management(page=${currentPage - 1}, size=${pageSize}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}" 
                           style="padding: 8px 16px; border: 1px solid #e2e8f0; border-radius: 6px; text-decoration: none; color: #64748b; background: white;">
                            <i class="fas fa-chevron-left"></i> Trước
                        </a>
                        <a th:if="${currentPage <= 1}" 
                           style="padding: 8px 16px; border: 1px solid #e2e8f0; border-radius: 6px; text-decoration: none; color: #94a3b8; background: #f8fafc; cursor: not-allowed; pointer-events: none;">
                            <i class="fas fa-chevron-left"></i> Trước
                        </a>

                        <th:block th:each="i : ${#numbers.sequence(1, totalPages)}">
                            <a th:if="${i == currentPage}" 
                               style="padding: 8px 12px; border: 1px solid #667eea; border-radius: 6px; text-decoration: none; color: white; background: #667eea; font-weight: 600;" 
                               th:text="${i}">1</a>
                            <a th:if="${i != currentPage}" 
                               th:href="@{/admin/vehicle-management(page=${i}, size=${pageSize}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}" 
                               style="padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; text-decoration: none; color: #64748b; background: white;" 
                               th:text="${i}">1</a>
                        </th:block>

                        <a th:if="${currentPage < totalPages}" 
                           th:href="@{/admin/vehicle-management(page=${currentPage + 1}, size=${pageSize}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}" 
                           style="padding: 8px 16px; border: 1px solid #e2e8f0; border-radius: 6px; text-decoration: none; color: #64748b; background: white;">
                            Sau <i class="fas fa-chevron-right"></i>
                        </a>
                        <a th:if="${currentPage >= totalPages}" 
                           style="padding: 8px 16px; border: 1px solid #e2e8f0; border-radius: 6px; text-decoration: none; color: #94a3b8; background: #f8fafc; cursor: not-allowed; pointer-events: none;">
                            Sau <i class="fas fa-chevron-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Vehicle Modal -->
    <div id="vehicleModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Thêm Xe Mới</h2>
            <span class="close" onclick="closeVehicleModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="vehicleForm" onsubmit="saveVehicle(event)">
                <input type="hidden" id="vehicleId">
                
                <div class="form-group">
                    <label for="vehicleIdInput">Mã xe <span class="required">*</span></label>
                    <input type="text" id="vehicleIdInput" required>
                </div>

                <div class="form-group">
                    <label for="vehicleName">Tên xe <span class="required">*</span></label>
                    <input type="text" id="vehicleName" required>
                </div>

                <div class="form-group">
                    <label for="vehicleNumber">Biển số xe <span class="required">*</span></label>
                    <input type="text" id="vehicleNumber" required>
                </div>

                <div class="form-group">
                    <label for="vehicleType">Loại xe <span class="required">*</span></label>
                    <input type="text" id="vehicleType" required>
                </div>

                <div class="form-group">
                    <label for="status">Trạng thái <span class="required">*</span></label>
                    <select id="status" required>
                        <option value="ready">Sẵn sàng</option>
                        <option value="in_use">Đang sử dụng</option>
                        <option value="maintenance">Bảo dưỡng</option>
                        <option value="repair">Sửa chữa</option>
                        <option value="checking">Kiểm tra</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="groupId">Nhóm xe</label>
                    <select id="groupId">
                        <option value="">-- Chọn nhóm xe (tùy chọn) --</option>
                        <option th:each="group : ${vehicleGroups}" 
                                th:value="${group.groupId}" 
                                th:text="${group.name}">
                            Group Name
                        </option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-cancel" onclick="closeVehicleModal()">Hủy</button>
            <button type="submit" form="vehicleForm" class="btn-save">Lưu</button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h2>Xác nhận xóa</h2>
            <span class="close" onclick="closeDeleteModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>Bạn có chắc chắn muốn xóa xe này không?</p>
            <p class="warning-text">Hành động này không thể hoàn tác!</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-cancel" onclick="closeDeleteModal()">Hủy</button>
            <button type="button" class="btn-delete-confirm" onclick="confirmDelete()">Xóa</button>
        </div>
    </div>
</div>

<script th:src="@{/js/vehicle-management.js}"></script>



