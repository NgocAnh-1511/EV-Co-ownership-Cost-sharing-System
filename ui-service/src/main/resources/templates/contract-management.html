<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Quản Lý Hợp Đồng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* Basic styling for cards and badges */
        .summary-card { margin-bottom: 20px; }
        .status-badge { padding: 0.3em 0.6em; border-radius: 0.25rem; font-size: 85%; }
        .status-active { background-color: #d4edda; color: #155724; } /* Green */
        .status-pending { background-color: #fff3cd; color: #856404; } /* Yellow */
        .status-finished { background-color: #f8d7da; color: #721c24; } /* Red */
        .action-icon { margin-right: 8px; color: #007bff; }
        .action-icon.edit { color: #ffc107; }
        .action-icon.download { color: #17a2b8; }
        .vehicle-img { width: 50px; height: auto; margin-right: 10px; border-radius: 4px; object-fit: cover; } /* Added object-fit */
        .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; } /* Styling for success message */
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <a class="navbar-brand" href="#">CarShare</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item"><a class="nav-link" th:href="@{/}">Trang chủ</a></li>
            <li class="nav-item"><a class="nav-link" href="#">Xe của tôi</a></li>
            <li class="nav-item active"><a class="nav-link" th:href="@{/hop-dong}">Hợp đồng <span class="sr-only">(current)</span></a></li>
            <li class="nav-item"><a class="nav-link" href="#">Thanh toán</a></li>
            <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                <a class="nav-link" th:href="@{/admin/dashboard}">Quản trị</a>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto" sec:authorize="isAuthenticated()">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownUser" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-user-circle mr-1"></i>
                    <span sec:authentication="name">Tên User</span> </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownUser">
                    <a class="dropdown-item" href="#">Thông tin tài khoản</a>
                    <div class="dropdown-divider"></div>
                    <form th:action="@{/logout}" method="post" class="form-inline d-inline">
                        <button class="dropdown-item" type="submit">Đăng xuất</button>
                    </form>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#"><i class="fas fa-bell"></i></a>
            </li>
        </ul>
    </div>
</nav>
<div class="container mt-4">
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${successMessage}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div th:if="${errorMessage}" class="alert alert-warning" th:text="${errorMessage}"></div>


    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Quản Lý Hợp Đồng</h2>
        <a th:href="@{/hop-dong/tao-moi}" class="btn btn-primary"><i class="fas fa-plus mr-1"></i> Tạo hợp đồng mới</a>
    </div>
    <p class="text-muted">Quản lý các hợp đồng đồng sở hữu xe của bạn</p>

    <div class="row" th:if="${summary != null}">
        <div class="col-lg-3 col-md-6">
            <div class="card summary-card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-muted">Tổng hợp đồng</h5>
                    <p class="card-text display-4 font-weight-bold" th:text="${summary.totalContracts}">0</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card summary-card shadow-sm">
                <div class="card-body text-success">
                    <h5 class="card-title">Đang hoạt động</h5>
                    <p class="card-text display-4 font-weight-bold" th:text="${summary.activeContracts}">0</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card summary-card shadow-sm">
                <div class="card-body text-warning">
                    <h5 class="card-title">Chờ ký</h5>
                    <p class="card-text display-4 font-weight-bold" th:text="${summary.pendingContracts}">0</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card summary-card shadow-sm">
                <div class="card-body text-danger">
                    <h5 class="card-title">Đã kết thúc</h5>
                    <p class="card-text display-4 font-weight-bold" th:text="${summary.finishedContracts}">0</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <form class="form-inline">
                <input type="text" class="form-control mr-sm-2 flex-grow-1 mb-2 mb-sm-0" placeholder="Tìm kiếm hợp đồng...">
                <select class="custom-select mr-sm-2 mb-2 mb-sm-0">
                    <option selected>Tất cả trạng thái</option>
                    <option value="active">Đang hoạt động</option>
                    <option value="pending">Chờ ký</option>
                    <option value="finished">Đã kết thúc</option>
                </select>
                <select class="custom-select mr-sm-2 mb-2 mb-sm-0">
                    <option selected>Tất cả loại xe</option>
                </select>
                <button type="submit" class="btn btn-outline-secondary mr-2"><i class="fas fa-filter"></i></button>
                <button type="button" class="btn btn-outline-info"><i class="fas fa-download"></i></button>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title mb-3">Danh sách hợp đồng</h5>
            <div th:if="${contractPage == null or contractPage.empty}" class="alert alert-info">
                Không có hợp đồng nào được tìm thấy.
            </div>
            <div th:if="${contractPage != null and !contractPage.empty}" class="table-responsive"> <table class="table table-hover align-middle"> <thead class="thead-light"> <tr>
                <th>Mã hợp đồng</th>
                <th>Thông tin xe</th>
                <th>Ngày ký</th>
                <th>Thời hạn</th>
                <th>Trạng thái</th>
                <th>Thao tác</th>
            </tr>
            </thead>
                <tbody>
                <tr th:each="contract : ${contractPage.content}">
                    <td>
                        <strong th:text="${contract.contractCode}">HD00X</strong><br>
                        <small class="text-muted">Hợp đồng đồng sở hữu</small>
                    </td>
                    <td>
                        <img th:src="${contract.vehicleImageUrl != null ? contract.vehicleImageUrl : 'https://via.placeholder.com/50x30?text=No+Image'}"
                             alt="Ảnh xe" class="vehicle-img float-left"/>
                        <div> <strong th:text="${contract.vehicleInfo}">Xe Mẫu</strong><br>
                            <small class="text-muted" th:text="${contract.vehicleIdentifier}">Biển số</small>
                        </div>
                    </td>
                    <td th:text="${contract.signingDateTime != null ? #temporals.format(contract.signingDateTime, 'dd/MM/yyyy HH:mm') : 'N/A'}">dd/MM/yyyy HH:mm</td>
                    <td th:text="${contract.duration}">N/A</td>
                    <td>
                                    <span class="status-badge"
                                          th:classappend="${#strings.containsIgnoreCase(contract.status, 'hoạt động') ? 'status-active' :
                                                          (#strings.containsIgnoreCase(contract.status, 'Chờ ký') ? 'status-pending' :
                                                          (#strings.containsIgnoreCase(contract.status, 'kết thúc') ? 'status-finished' : 'bg-secondary text-white'))}"
                                          th:text="${contract.status}">Trạng thái</span>
                    </td>
                    <td>
                        <a href="#" class="action-icon" title="Xem chi tiết"><i class="fas fa-eye"></i></a>
                        <a href="#" class="action-icon edit" title="Chỉnh sửa"><i class="fas fa-edit"></i></a>
                        <a href="#" class="action-icon download" title="Tải xuống"><i class="fas fa-download"></i></a>
                    </td>
                </tr>
                </tbody>
            </table>

                <nav aria-label="Page navigation" th:if="${contractPage.totalPages > 1}">
                    <ul class="pagination justify-content-center flex-wrap"> <li class="page-item" th:classappend="${contractPage.first ? 'disabled' : ''}">
                        <a class="page-link" th:href="@{/hop-dong(page=${currentPage - 1}, size=${contractPage.size})}">Trước</a>
                    </li>
                        <li class="page-item" th:each="pageNumber : ${#numbers.sequence( T(java.lang.Math).max(0, currentPage - 2), T(java.lang.Math).min(contractPage.totalPages - 1, currentPage + 2) )}"
                            th:classappend="${pageNumber == currentPage ? 'active' : ''}">
                            <a class="page-link" th:href="@{/hop-dong(page=${pageNumber}, size=${contractPage.size})}" th:text="${pageNumber + 1}">1</a>
                        </li>
                        <li class="page-item" th:classappend="${contractPage.last ? 'disabled' : ''}">
                            <a class="page-link" th:href="@{/hop-dong(page=${currentPage + 1}, size=${contractPage.size})}">Sau</a>
                        </li>
                    </ul>
                </nav>
            </div> </div> </div> <div class="row mt-4">
    <div class="col-md-4 mb-3">
        <div class="card text-center h-100">
            <div class="card-body d-flex flex-column justify-content-between">
                <div>
                    <h5 class="card-title"><i class="fas fa-signature text-primary mb-2"></i> Ký hợp đồng điện tử</h5>
                    <p class="card-text">Xem và ký các hợp đồng đang chờ của bạn.</p>
                </div>
                <a href="#" class="btn btn-outline-primary mt-3">Thực hiện</a>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card text-center h-100">
            <div class="card-body d-flex flex-column justify-content-between">
                <div>
                    <h5 class="card-title"><i class="fas fa-file-pdf text-info mb-2"></i> Tải xuống hợp đồng</h5>
                    <p class="card-text">Xuất file PDF các hợp đồng đã ký của bạn.</p>
                </div>
                <a href="#" class="btn btn-outline-info mt-3">Thực hiện</a>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card text-center h-100">
            <div class="card-body d-flex flex-column justify-content-between">
                <div>
                    <h5 class="card-title"><i class="fas fa-chart-line text-warning mb-2"></i> Báo cáo hợp đồng</h5>
                    <p class="card-text">Xem thống kê chi tiết về các hợp đồng.</p>
                </div>
                <a href="#" class="btn btn-outline-warning mt-3">Thực hiện</a>
            </div>
        </div>
    </div>
</div> </div> <footer class="text-center mt-5 mb-3 text-muted">
    <p>&copy; <span th:text="${#dates.year(#dates.createNow())}">2025</span> CarShare. All rights reserved.</p>
</footer>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>