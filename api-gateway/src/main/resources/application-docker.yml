server:
  port: 8084

spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      routes:
        # Cost Payment Service Routes (including /api/funds/**)
        - id: cost-payment-service
          uri: http://cost-payment-service:8081
          predicates:
            - Path=/api/costs/**, /api/payments/**, /api/shares/**, /api/cost-shares/**, /api/auto-split/**, /api/usage-tracking/**, /api/funds/**, /api/my-vehicles, /api/auth/logout
        
        # Group Management Service Routes
        - id: group-management-service
          uri: http://group-management-service:8082
          predicates:
            - Path=/api/groups/**, /api/votes/**, /api/admin/auth/login
        
        # Reservation Service - Users Vehicles Route (phải đặt trước để match /api/users/*/vehicles)
        - id: reservation-service-users-vehicles
          uri: http://reservation-service:8086
          predicates:
            - Path=/api/users/*/vehicles
          order: 1
        
        # Reservation Service - Vehicles Reservations Route (phải đặt trước vehicle-service)
        - id: reservation-service-vehicles-reservations
          uri: http://reservation-service:8086
          predicates:
            - Path=/api/vehicles/*/reservations/**
          order: 1
        
        # Reservation Service - Vehicles Group Route (phải đặt trước vehicle-service)
        - id: reservation-service-vehicles-group
          uri: http://reservation-service:8086
          predicates:
            - Path=/api/vehicles/*/group
          order: 1
        
        # Reservation Service Routes
        - id: reservation-service
          uri: http://reservation-service:8086
          predicates:
            - Path=/api/reservations/**, /api/fairness/**
          order: 2
        
        # User Account Service Routes
        - id: user-account-service
          uri: http://user-account-service:8083
          predicates:
            - Path=/api/auth/**, /api/users/**, /api/my-vehicles
          order: 3
        
        # User uploads (images, documents) - must be before user-account-service
        - id: user-account-uploads
          uri: http://user-account-service:8083
          predicates:
            - Path=/uploads/**
          order: 1
        
        # Vehicle Service Routes
        - id: vehicle-service
          uri: http://vehicle-service:8085
          predicates:
            - Path=/api/vehicles/**, /api/vehicle-services/**, /api/vehicle-groups/**, /api/services/**
        
        # Reservation Admin Service Routes
        - id: reservation-admin-service
          uri: http://reservation-admin-service:8087
          predicates:
            - Path=/api/admin/reservations/**
        
        # Legal Contract Service Routes
        - id: legal-contract-service
          uri: http://legal-contract-service:8089
          predicates:
            - Path=/api/contracts/**, /api/legalcontracts/**
        
        # Dispute Management Service Routes
        - id: dispute-management-service
          uri: http://dispute-management-service:8090
          predicates:
            - Path=/api/disputes/**
        
        # UI Service Routes (for /api/fund/** and /api/vehicle-maintenance/** endpoints)
        - id: ui-service-fund
          uri: http://ui-service:8080
          predicates:
            - Path=/api/fund/**
        
        # UI Service Routes (for /api/vehicle-maintenance/** endpoints)
        - id: ui-service-vehicle-maintenance
          uri: http://ui-service:8080
          predicates:
            - Path=/api/vehicle-maintenance/**
      
      # Global CORS Configuration
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: 
              - "http://localhost:8080"
              - "http://ui-service:8080"
              - "http://localhost:3000"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - PATCH
              - OPTIONS
            allowedHeaders: "*"
            allowCredentials: true
            maxAge: 3600
      
      # Default Filters - Remove duplicate CORS headers from downstream services
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin Access-Control-Allow-Headers Access-Control-Allow-Methods

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
  endpoint:
    health:
      show-details: always

# Logging
logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    org.springframework.web: INFO

